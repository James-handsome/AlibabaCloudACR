name: Docker Image Sync to ACR

on:
  workflow_dispatch:
    inputs:
      image_name:
        description: 'Docker Hub é•œåƒå (ä¾‹å¦‚: mysql:8.0)'
        required: true
        default: 'mysql:latest'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Login to Alibaba Cloud ACR
        uses: docker/login-action@v3
        with:
          registry: ${{ secrets.ACR_REGISTRY }}
          username: ${{ secrets.ACR_USERNAME }}
          password: ${{ secrets.ACR_PASSWORD }}

      - name: Pull and Push to Aliyun
        run: |
          RAW_IMAGE="${{ github.event.inputs.image_name }}"
      
          docker pull "$RAW_IMAGE"
          
          SAFE_TAG=$(echo "$RAW_IMAGE" | sed 's/[\/:]/_/g')
          
          # æ¨é€æ—¶ä¾ç„¶å¯ä»¥ä½¿ç”¨ Secret ç¡®ä¿å®‰å…¨
          TARGET_IMAGE="crpi-tjpbhu7ev24zh1rq.cn-hangzhou.personal.cr.aliyuncs.com/garendeng_zhanhao/james-hub:$SAFE_TAG"
          
          docker tag "$RAW_IMAGE" "$TARGET_IMAGE"
          docker push "$TARGET_IMAGE"
          
          echo "=========================================================="
          echo "âœ… åŒæ­¥æˆåŠŸï¼"
          echo "ğŸš€ é˜¿é‡Œäº‘æ‹‰å–å‘½ä»¤ï¼š"
          echo "docker pull $TARGET_IMAGE" 
          echo "=========================================================="





