name: Docker Image Sync to ACR

on:
  workflow_dispatch:
    inputs:
      image_name:
        description: 'Docker Hub 镜像名 (例如: mysql:8.0)'
        required: true
        default: 'mysql:latest'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Login to Alibaba Cloud ACR
        uses: docker/login-action@v3
        with:
          registry: ${{ secrets.ACR_REGISTRY }}
          username: ${{ secrets.ACR_USERNAME }}
          password: ${{ secrets.ACR_PASSWORD }}

      - name: Pull and Push to Aliyun
        run: |
          # 1. 从 Docker Hub 拉取 (Actions 运行环境在海外，拉取很快)
          docker pull ${{ github.event.inputs.image_name }}
          
          # 2. 这里的路径必须与你截图中的“公网地址/命名空间/仓库名”完全对应
          # 注意：这里的 garendeng_zhanhao/james-hub 是从你截图里推导出来的
          TARGET_IMAGE="${{ secrets.ACR_REGISTRY }}/garendeng_zhanhao/james-hub:${{ github.event.inputs.image_name }}"
          
          # 3. 打标签并推送到阿里云
          docker tag ${{ github.event.inputs.image_name }} $TARGET_IMAGE
          docker push $TARGET_IMAGE
          
          echo "同步完成！镜像地址为: $TARGET_IMAGE"